#cloud-config
# https://github.com/ahpnils/lab-as-code/blob/be47a0d8aabf66b38f718de35546411eb60c879b/cloud-init/isp1router1/user-data#L4
vyos_config_commands:
  # System configuration
  - set system host-name 'vyos-lts'
  - set system ntp server cn.ntp.org.cn
  - set system time-zone 'Asia/Shanghai'

  # auth config
  - set system login user vagrant authentication plaintext-password vagrant
  - set system login user vagrant authentication public-keys vagrant key AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ==
  - set system login user vagrant authentication public-keys 'vagrant' type ssh-rsa

  # # Addressing for local interfaces
  - set interfaces ethernet eth1 address '192.168.255.1/24'
  - set interfaces ethernet eth1 description LAN

  # # ssh
  - set service ssh port 22

  # DHCP server for local network
  - set service dhcp-server shared-network-name LAN subnet 192.168.255.0/24 range 0 start 192.168.255.100
  - set service dhcp-server shared-network-name LAN subnet 192.168.255.0/24 range 0 stop 192.168.255.200
  - set service dhcp-server shared-network-name LAN subnet 192.168.255.0/24 name-server 192.168.255.1
  - set service dhcp-server shared-network-name LAN subnet 192.168.255.0/24 default-router 192.168.255.1
  - set service dhcp-server shared-network-name LAN subnet 192.168.255.0/24 domain-name sololab

  - set service dhcp-server shared-network-name LAN authoritative
  - set service dhcp-server shared-network-name LAN ping-check
  - set service dhcp-server hostfile-update
  - set service dhcp-server host-decl-name

  # DNS
  - set service dns forwarding cache-size '0'
  - set service dns forwarding listen-address '192.168.255.1'
  - set service dns forwarding allow-from '192.168.255.0/24'
  - set service dns forwarding name-server 223.5.5.5
  - set service dns forwarding name-server 223.6.6.6
  - set system name-server 192.168.255.1

  - commit
  - save
  - exit
