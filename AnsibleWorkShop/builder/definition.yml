# code: language=ansible
# https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.0-ea/html-single/ansible_builder_guide/index
version: 1

build_arg_defaults:
  ANSIBLE_GALAXY_CLI_COLLECTION_OPTS: "-v"

# ansible_config: 'ansible.cfg'

dependencies:
  galaxy: ../requirements.yml
  python: ../requirements.txt
  system: ../bindep.txt

additional_build_steps:
  append: |
    RUN export HTTPS_PROXY=${PROXY} HTTP_PROXY=${PROXY} && \
      curl -L "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl" -o /usr/local/bin/kubectl && \
      ls -al /usr/local/bin/kubectl && \
      chmod 0755 /usr/local/bin/kubectl && \
      curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 && \
      chmod 700 get_helm.sh && VERIFY_CHECKSUM=false bash ./get_helm.sh && rm -f ./get_helm.sh \
      unset HTTPS_PROXY && \
      unset HTTP_PROXY
